{% extends "mediastory/base.html" %}
{% load polytype %}{% load embed_video_tags %}{% load fb_versions %}

{% block middle %}
    <div class="jumbotron">
        <div class="container">
            <div class="row">
                <div class="span12">
                    <h1>{{ location.name }}</h1>

                    <p>{{ location.description|safe }}</p>

                    <p><a id="viewbtn" class="btn btn-lg btn-primary" href="#" title="View media"
                          style="margin: 15px 15px 0 15px;">View Media</a></p>

                    <p><a id="closebtn" class="btn btn-default" href="#" title="Go back to the map"
                          style="margin: 15px 15px 0 15px;">Close</a></p>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_script %}
    <script type="text/javascript">
        $(document).ready(function () {

            $("#closebtn").click(function () {
                window.close();
            });

            $("#viewbtn").click(function (event) {
               event.preventDefault();

               $.iLightBox([
                    {% for item in media_items %}
                        {% with item|modeltype as modeltype %}
                            {% if modeltype == "ExternalVideoMediaItem" %}
                                {% video item.video as v %}
                                    {
                                        URL: 'http://www.youtube.com/embed/{{ v.code }}?autoplay=1&autohide=1&border=0&egm=0&showinfo=0',
                                        title: '{{ item.title }}',
                                        caption: '{{ item.description|safe|striptags|truncatewords_html:150|escapejs }}{% if item.attribution %}<p><em>Attribution: {{ item.attribution }}</em></p>{% endif %}',
                                        type: 'iframe',
                                        options: {
                                            thumbnail: 'http://img.youtube.com/vi/{{ v.code }}/1.jpg',
                                            icon: 'video',
                                            width: 800
                                        }
                                    }
                                {% endvideo %}
                            {% elif modeltype == "VideoMediaItem" %}
                                {
{#                                    URL: "{% url 'videoitem_embed' item.id %}",#}
                                    URL: '{{ item.video_file_mp4 }}',
                                    title: '{{ item.title }}',
                                    type: 'video',
                                    caption: '{{ item.description|safe|striptags|truncatewords_html:150|escapejs }}{% if item.attribution %}<p><em>Attribution: {{ item.attribution }}</em></p>{% endif %}',
                                    options: {
                                        width: 800,
                                        videoType: 'video/mp4',
                                        html5video: {
                                            h264: '{{ item.video_file_mp4 }}',
                                            webm: '{{ item.video_file_webm }}',
{#                                            poster: '/path/video-poster.jpg',#}
                                            controls: false,
                                            autoplay: true,
                                            preload: 'auto'
                                        }
                                    }
                                }
                            {% elif modeltype == 'ImageMediaItem' %}
                                {
                                    URL: '{% version item.image 'xtra-big' %}',
                                    type: 'image',
                                    title: '{{ item.title }}',
                                    caption: '{{ item.description|safe|striptags|truncatewords_html:150|escapejs }}{% if item.attribution %}<p><em>Attribution: {{ item.attribution }}</em></p>{% endif %}'
                                }
                            {% elif modeltype == 'TextMediaItem' %}
                                {
                                    URL: "{% url 'mediaitem_detail' item.id %}",
                                    title: '{{ item.title }}',
                                    type: 'ajax',
                                    caption: '{{ item.description|safe|striptags|truncatewords_html:150|escapejs }}{% if item.attribution %}<p><em>Attribution: {{ item.attribution }}</em></p>{% endif %}',
                                    options: {
                                        width: 800
                                    }
                                }
                            {% elif modeltype == 'AudioMediaItem' %}
                                {
                                    URL: "{% url 'mediaitem_detail' item.id %}",
                                    title: '{{ item.title }}',
                                    type: 'ajax',
                                    caption: '{{ item.description|safe|striptags|truncatewords_html:150|escapejs }}{% if item.attribution %}<p><em>Attribution: {{ item.attribution }}</em></p>{% endif %}',
                                    options: {
                                        width: 800,
                                        height: 500
                                    }
                                }
                            {%  endif %}
                        {%  endwith %}
                        {% if not forloop.last %}, {% endif %}
                    {% endfor %}
               ],
               {
                   skin: 'mac',
                   fullStretchTypes: 'image, flash, video',
                   mousewheel: false,
                   styles: {
                       pageOffsetX: 30,
                       pageOffsetY: 30
                   }

               }

               );


            });

        });

    </script>
{% endblock %}
