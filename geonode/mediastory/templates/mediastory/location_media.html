{% extends "mediastory/base.html" %}
{%  load polytype %}{% load embed_video_tags %}{% load fb_versions %}

{% block middle %}
<div class="mediaitem-container container-fluid">
    <div class="row">
        <div class="span12">
            <div class="title-area ">
                <h1>{{  location.name  }}</h1>
                {{  location.description|safe }}
            </div>
        </div>
    </div>

 <div class="navigation">
        <a href="{% url 'location_list' %}" title="Go back to the map">&lt; Back to map</a>
    </div>

        <div class="mediaitem-content media-content-types">
            <div class="row">
                {% if audio_items %}
                <div class="col-xs-6">
                    <div class="mediaitem audio">
                        <a href="#">
                            <i class="fa fa-music fa-5x"></i>
                            <h2>Audio</h2>
                            <p>({{  audio_items|length }} audio clips)</p>
                        </a>
                    </div>
                </div>
                {%  endif %}
                {% if image_items %}
                <div class="col-xs-6">
                    <div class="mediaitem images">
                    <a href="#">
                        <i class="fa fa-picture-o fa-5x"></i>
                        <h2>Images</h2>
                         <p>({{  image_items|length }} images)</p>
                    </a>
                    </div>
                </div>
                {%  endif %}
                {%  if text_items %}
                <div class="col-xs-6">
                    <div class="mediaitem text">
                    <a href="#">
                        <i class="fa fa-file-text-o fa-5x"></i>
                        <h2>Text</h2>
                        <p>({{  text_items|length }} documents)</p>
                    </a>
                        </div>
                </div>
                {%  endif %}
                {% if video_items %}
                <div class="col-xs-6">
                    <div class="mediaitem extvideo">
                    <a href="#">
                        <i class="fa fa-video-camera fa-5x"></i>
                        <h2>Video</h2>
                        <p>({{  video_items|length }} videos)</p>
                    </a>
                        </div>
                </div>
                {%  endif %}
            </div>

        </div>
    </div>

{%  endblock %}

{%  block extra_script %}
 <script type="text/javascript">
   $(document).ready(function() {
        $('.images a').on('click', function(event) {
            // stops default click behavior
            event.preventDefault();

            Lightview.show([
                {% for item in image_items %}
                    {
                        url: '{% version item.image 'xtra-big' %}',
                        title: '{{ item.title }}',
                        caption: '{{ item.description|safe|striptags|truncatewords_html:150|escapejs }}{% if item.attribution %}<p><em>Attribution: {{ item.attribution }}</em></p>{% endif %}'
                    }
                    {% if not forloop.last %}, {% endif %}
                {% endfor %}

            ],
            { skin: 'mac', width: '100%', height: '100%', controls: 'thumbnails' });

      });

        $('.extvideo a').on('click', function(event) {
                // stops default click behavior
                event.preventDefault();

                Lightview.show([
                    {% for item in video_items %}
                        {% with item|modeltype as modeltype %}
                            {% if modeltype == "ExternalVideoMediaItem" %}
                             {% video item.video as v %}
                                {
                                    url: 'http://www.youtube.com/embed/{{ v.code }}?autoplay=1&autohide=1&border=0&egm=0&showinfo=0',
                                    title: '{{ item.title }}',
                                    caption: '{{ item.description|safe|striptags|truncatewords_html:150|escapejs }}{% if item.attribution %}<p><em>Attribution: {{ item.attribution }}</em></p>{% endif %}',
                                    thumbnail: 'http://img.youtube.com/vi/{{ v.code }}/1.jpg'
                                }
                             {% endvideo %}
                            {% elif modeltype == "VideoMediaItem" %}
                                {
                                    url: "{% url 'videoitem_embed' item.id %}",
                                    title: '{{ item.title }}',
                                    caption: '{{ item.description|safe|striptags|truncatewords_html:150|escapejs }}{% if item.attribution %}<p><em>Attribution: {{ item.attribution }}</em></p>{% endif %}',
                                }
                            {%  endif %}
                        {%  endwith %}
                        {% if not forloop.last %}, {% endif %}
                    {% endfor %}
                ],
                        { skin: 'mac', viewport: 'scale' });

          });

   $('.text a').on('click', function(event) {
                // stops default click behavior
                event.preventDefault();

                Lightview.show([
                    {% for item in text_items %}
                        {
                            url: "{% url 'mediaitem_detail' item.id %}",
                            title: '{{ item.title }}',
                            type: 'iframe',
                            caption: '{{ item.description|safe|striptags|truncatewords_html:150|escapejs }}{% if item.attribution %}<p><em>Attribution: {{ item.attribution }}</em></p>{% endif %}'
                        }
                        {% if not forloop.last %}, {% endif %}
                    {% endfor %}

                ],
                        { skin: 'mac', controls: 'thumbnails' });

          });

     $('.audio a').on('click', function(event) {
                // stops default click behavior
                event.preventDefault();

                Lightview.show([
                    {% for item in audio_items %}
                        {
                            url: "{% url 'mediaitem_detail' item.id %}",
                            title: '{{ item.title }}',
                            type: 'iframe',
                            caption: '{{ item.description|safe|striptags|truncatewords_html:150|escapejs }}{% if item.attribution %}<p><em>Attribution: {{ item.attribution }}</em></p>{% endif %}'
                        }
                        {% if not forloop.last %}, {% endif %}
                    {% endfor %}

                ],
                { skin: 'mac' });

          });
       });

</script>
{% endblock %}
